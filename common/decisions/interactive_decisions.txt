interactive_bannermen_mode_decision = {
	desc = interactive_bannermen_mode_decision_desc
	selection_tooltip = interactive_bannermen_mode_decision_tooltip

	is_shown = {
		has_game_rule = bannermen_mode_enabled
		highest_held_title_tier >= tier_duchy
		is_landed = yes
		is_ruler = yes
	}

	is_valid = {
		is_at_war = yes
	}

	cooldown = { months = 12 }

	ai_check_interval = 6

	ai_potential = {
		has_game_rule = bannermen_mode_enabled
		is_at_war = yes
		highest_held_title_tier >= tier_duchy
		is_landed = yes
		is_ruler = yes
	}
	
	ai_will_do = {
		base = 1000
	}

	effect = {
		custom_tooltip = interactive_bannermen_mode_decision_effect

		hidden_effect = {
			save_temporary_scope_as = liege

			if = {
				limit = {
					scope:liege = {
						is_ai = no
					}
				}
				play_music_cue = "mx_cue_combat_2"
			}

			if = {
				limit = {
					OR = {
						AND = {
							scope:liege = { is_ai = no }
							has_game_rule = civil_war_indirect_vassals_enabled
							scope:liege = {
								any_character_war = {
									primary_defender = { is_liege_or_above_of = scope:liege }
									primary_attacker = scope:liege
								}
							}
						}
						scope:liege = {
							any_character_war = {
								NOT = { primary_attacker = { is_vassal_of = scope:liege } }
							}
						}
					}
				}
					scope:liege = {
						every_vassal = {
							limit = {
								OR = {
									AND = {
										scope:liege = { highest_held_title_tier < tier_empire }
										highest_held_title_tier >= tier_county
									}
									highest_held_title_tier >= tier_duchy
								}
								max_military_strength > 200
								is_landed = yes
								is_ai = yes
								is_capable_adult = yes
								is_imprisoned = no
							}
							save_temporary_scope_as = vassal
							if = {
								limit = {
									NOT = {
										opinion = {
											target = scope:liege
											value <= -80
										}
									}
									OR = {
										opinion = {
											target = scope:liege
											value >= -25
										}
										is_allied_to = scope:liege
										ai_honor >= medium_positive_ai_value
										has_trait = loyal
										has_dread_level_towards = {
											target = scope:liege
											level = 2
										}
										is_heir_of = scope:liege
										scope:liege = { has_strong_hook = scope:vassal }		
									}
									NOT = { is_at_war_with = scope:liege }
									NOT = {
										scope:liege = {
											has_opinion_modifier = {
												modifier = miv_oathbreaker
												target = scope:vassal
											}
										}
									}
								}
								add_to_list = interactive_accept
							}
							else_if = {
								limit = {
									NOT = { is_at_war_with = scope:liege }
									NOT = {
										scope:liege = {
											has_opinion_modifier = {
												modifier = miv_oathbreaker
												target = scope:vassal
											}
										}
									}
									NOT = {
										any_character_war = {
											primary_defender = scope:liege
										}
									}
									NOT = {
										any_character_war = {
											primary_attacker = scope:liege
										}
									}
								}
								add_to_list = interactive_refuse
							}
						}

						every_character_war = {
							save_temporary_scope_as = war
							if = {
								limit = {
									scope:war = { any_war_attacker = { this = scope:liege } }
									OR = {
										scope:war = { primary_attacker = scope:liege }
										scope:liege = { is_ai = no }
										AND = {
											OR = {
												has_game_rule = bannermen_extended_mode_2_enabled
												has_global_variable = AGOT_is_loaded
											}
											scope:liege = { highest_held_title_tier >= tier_kingdom }
										}
										#AND = {
										#	has_game_rule = bannermen_extended_mode_3_enabled
										#	scope:liege = { highest_held_title_tier >= tier_duchy }
										#}
									}
									NAND = {
										scope:war = {
											primary_attacker = {
												is_vassal_of = scope:war.primary_defender
											}
											primary_defender = {
												this = scope:liege
											}
										}
									}
								}
								every_in_list = {
									list = interactive_accept
									save_temporary_scope_as = vassal
									if = {
										limit = {
											scope:vassal = { NOT = { is_at_war_with = scope:war.primary_attacker } }
											scope:vassal = { NOT = { is_at_war_with = scope:war.primary_defender } }
										}
										scope:vassal = {
											trigger_event = {
												id = interactive.0004
												days = { 2 80 }
											}
											add_opinion = {
												target = liege
												modifier = war_exhaustion_vassal_opinion
												opinion = -10
											}	
										}
									}
								}
							}
							else_if = {
								limit = {
									scope:war = { any_war_defender = { this = scope:liege } }
									OR = {
										scope:war = { primary_defender = scope:liege }
										scope:liege = { is_ai = no }
										AND = {
											OR = {
												has_game_rule = bannermen_extended_mode_2_enabled
												has_global_variable = AGOT_is_loaded
											}
											scope:liege = { highest_held_title_tier >= tier_kingdom }
										}
										#AND = {
										#	has_game_rule = bannermen_extended_mode_3_enabled
										#	scope:liege = { highest_held_title_tier >= tier_duchy }
										#}
									}
									NAND = {
										scope:war = {
											primary_attacker = {
												is_vassal_of = scope:war.primary_defender
											}
											primary_defender = {
												this = scope:liege
											}
										}
									}
								}
								every_in_list = {
									list = interactive_accept
									save_temporary_scope_as = vassal
									if = {
										limit = {
											scope:vassal = { NOT = { is_at_war_with = scope:war.primary_attacker } }
											scope:vassal = { NOT = { is_at_war_with = scope:war.primary_defender } }
										}
										scope:vassal = {
											trigger_event = {
												id = interactive.0004
												days = { 2 80 }
											}
											add_opinion = {
												target = liege
												modifier = war_exhaustion_vassal_opinion
												opinion = -10
											}	
										}
									}
								}
							}
						}

						every_in_list = {
							list = interactive_refuse
							save_temporary_scope_as = vassal
							scope:liege = {
								add_opinion = {
									target = scope:vassal
									modifier = miv_oathbreaker
								}
							}
							if = {
								limit = {
									scope:liege = { is_ai = no }
								}
								scope:vassal = {
									trigger_event = {
										id = interactive.0006
										days = { 2 80 }
									}
								}
							}
						}
					}
			}
		}
	}

	sort_order = 1001

	picture = { reference = "gfx/interface/illustrations/decisions/decision_destiny_goal.dds" }
}

interactive_dont_call_vassals = {
	desc = interactive_dont_call_vassals_decision_desc
	selection_tooltip = interactive_dont_call_vassals_decision_tooltip
	is_shown = {
		is_landed = yes
		is_ruler = yes
		NOT = { has_character_flag = dont_call_vassals }
	} 
	effect = {
		custom_tooltip = interactive_dont_call_vassals_decision_effect
		add_character_flag = dont_call_vassals
	}
	ai_check_interval = 0
	ai_potential = {
		always = no
	}
	ai_will_do = {
		base = 0
	}
	sort_order = 1000
	picture = { reference = "gfx/interface/illustrations/decisions/decision_realm.dds" }
}

interactive_call_vassals = {
	desc = interactive_call_vassals_decision_desc
	selection_tooltip = interactive_call_vassals_decision_tooltip
	is_shown = {
		is_landed = yes
		is_ruler = yes
		has_character_flag = dont_call_vassals
	} 
	effect = {
		custom_tooltip = interactive_call_vassals_decision_effect
		remove_character_flag = dont_call_vassals
	}
	ai_check_interval = 0
	ai_potential = {
		always = no
	}
	ai_will_do = {
		base = 0
	}
	sort_order = 1000
	picture = { reference = "gfx/interface/illustrations/decisions/decision_realm.dds" }
}
