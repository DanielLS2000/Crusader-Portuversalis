# called when a war is started.
# same scopes are available in these events as in the CBs' on_declaration, this just fires for all CBs instead of a specific CB.
on_war_started = {
	on_actions = {
		on_war_started_war_alerts
	}
}


on_war_started_war_alerts = {
	effect = {
		scope:attacker = {
			#bw_build_revolt_defenses_effect = yes #BARONSWARS For The Barons' Wars mod compatibility. Make sure War Alerts is lower in the Paradox Launcher mod list than The Barons' Wars.
			#Vanilla notification to vassals that liege has declared war
			#if = {
			#	limit = {
			#		any_vassal_or_below = { is_ai = no }
			#	}
			#	every_vassal_or_below = {
			#		limit = { is_ai = no }
			#		send_interface_toast = {
			#			type = msg_war_declared_by_liege
			#			title = msg_war_declared_by_liege
			#			desc = msg_war_declared_by_liege_desc
			#			left_icon = scope:attacker
			#			right_icon = scope:defender
			#		}
			#	}
			#}
			#Pinned Attacker
			if = {
				limit = {
					exists = global_var:notify_of_war_pinned				
					global_var:notify_of_war_pinned = 1			
					any_pinning_character = {
						is_ai = no
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_neutral_message
						title = msg_war_declared_by_pinned
						desc = msg_war_declared_by_pinned_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#Close family wife attacker
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}
					is_female = yes
					any_spouse = {
						is_spouse_of = scope:attacker
						is_ai = no
						is_male = yes
						NOT = { has_relation_soulmate = scope:attacker }
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_by_wife
						desc = msg_war_declared_by_wife_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#Close family wife and soulmate attacker
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}
					is_female = yes
					any_spouse = {
						is_spouse_of = scope:attacker
						is_ai = no
						is_male = yes
						has_relation_soulmate = scope:attacker
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_by_wife_soulmate
						desc = msg_war_declared_by_wife_soulmate_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#Close family husband attacker
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}
					is_male = yes
					any_spouse = { 
						is_spouse_of = scope:attacker
						is_ai = no
						is_female = yes
						NOT = { has_relation_soulmate = scope:attacker }
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_by_husband
						desc = msg_war_declared_by_husband_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#Close family husband and soulmate attacker
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}
					is_male = yes
					any_spouse = { 
						is_spouse_of = scope:attacker
						is_ai = no
						is_female = yes
						has_relation_soulmate = scope:attacker
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_by_husband_soulmate
						desc = msg_war_declared_by_husband_soulmate_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#Close family concubine attacker
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}
					any_consort = { 
						NOT = { is_spouse_of = scope:attacker }
						is_ai = no
						NOT = { has_relation_soulmate = scope:attacker }
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_by_concubine
						desc = msg_war_declared_by_concubine_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#Close family concubine soulmate attacker
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}
					any_consort = { 
						NOT = { is_spouse_of = scope:attacker }
						is_ai = no
						has_relation_soulmate = scope:attacker
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_by_concubine_soulmate
						desc = msg_war_declared_by_concubine_soulmate_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#Close family son attacker
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}
					is_male = yes
					any_parent = {
						is_ai = no
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_by_son
						desc = msg_war_declared_by_son_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}					
			#Close family daughter attacker
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}
					is_female = yes
					any_parent = {
						is_ai = no
					}
				}
				every_player = {
					limit = { is_ai = no }
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_by_daughter
						desc = msg_war_declared_by_daughter_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#Close family father attacker
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}
					is_male = yes
					any_child = {
						is_ai = no
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_by_father
						desc = msg_war_declared_by_father_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#Close family mother attacker
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}
					is_female = yes
					any_child = {
						is_ai = no
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_by_mother
						desc = msg_war_declared_by_mother_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#Close family brother attacker
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}
					is_male = yes
					any_sibling = {
						is_ai = no
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_by_brother
						desc = msg_war_declared_by_brother_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#Close family sister attacker
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}
					is_female = yes
					any_sibling = {
						is_ai = no
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_by_sister
						desc = msg_war_declared_by_sister_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#Grandson attacker #NEW
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}
					is_male = yes
					any_close_family_member = {
						is_ai = no
						is_grandparent_of = scope:attacker
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_by_grandson
						desc = msg_war_declared_by_grandson_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#Granddaughter attacker #NEW
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}
					is_female = yes
					any_close_family_member = {
						is_ai = no
						is_grandparent_of = scope:attacker
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_by_granddaughter
						desc = msg_war_declared_by_granddaughter_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#Grandfather attacker #NEW
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}
					is_male = yes
					any_close_family_member = {
						is_ai = no
						is_grandchild_of = scope:attacker
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_by_grandfather
						desc = msg_war_declared_by_grandfather_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#Grandmother attacker #NEW
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}
					is_female = yes
					any_close_family_member = {
						is_ai = no
						is_grandchild_of = scope:attacker
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_by_grandmother
						desc = msg_war_declared_by_grandmother_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#Other close family not needed??
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}
					any_close_family_member = {
						is_ai = no
						NOT = { is_consort_of = scope:attacker }
						NOT = { is_spouse_of = scope:attacker }
						NOT = { is_sibling_of = scope:attacker }
						NOT = { is_parent_of = scope:attacker }
						NOT = { is_grandchild_of = scope:attacker }
						NOT = { is_grandparent_of = scope:attacker }
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_by_close_relative
						desc = msg_war_declared_by_close_relative_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#Heir HASHEDOUT #TODO
#			if = {
#				limit = {
#					exists = global_var:notify_of_war_family
#					OR = {
#						global_var:notify_of_war_family = 1
#						global_var:notify_of_war_family = 2
#					}
#					is_player_heir_of = { #Doesn't work "simple assign" "not expecting bracket"
#						any_player = {
#							is_ai = no
#							#NOT = { is_close_family_of = scope:attacker }
#						}
#					}
#				}
#				every_player = {
#					send_interface_message = {
#						type = notify_war_neutral_message
#						title = msg_war_declared_by_heir
#						desc = msg_war_declared_by_heir_message
#						left_icon = scope:attacker
#						right_icon = scope:defender
#					}
#				}
#			}
			#Close family your ally
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}
					any_ally = {
						is_ai = no
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_by_ally
						desc = msg_war_declared_by_ally_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}		
			#Close family your lover
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}				
					any_relation = {
						type = lover
						is_ai = no
						NOR = {
							#is_heir_of = scope:attacker
							is_close_family_of = scope:attacker
							is_allied_to = scope:attacker
						}
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_by_lover
						desc = msg_war_declared_by_lover_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#Close family your soulmate
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}				
					any_relation = {
						type = soulmate
						is_ai = no
						NOR = {
							#is_heir_of = scope:attacker
							is_close_family_of = scope:attacker
							is_allied_to = scope:attacker
						}
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_by_soulmate
						desc = msg_war_declared_by_soulmate_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#Close family your friend
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}				
					any_relation = {
						type = friend
						is_ai = no
						NOR = {
							#is_heir_of = scope:attacker
							is_close_family_of = scope:attacker
							is_allied_to = scope:attacker
							has_relation_best_friend = scope:attacker
						}
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_by_friend
						desc = msg_war_declared_by_friend_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#Close family your best friend
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}				
					any_relation = {
						type = best_friend
						is_ai = no
						NOR = {
							#is_heir_of = scope:attacker
							is_close_family_of = scope:attacker
							is_allied_to = scope:attacker
						}
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_by_best_friend
						desc = msg_war_declared_by_best_friend_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#Close family your ward #NOT RECIPRICOL
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}				
					any_relation = {
						type = guardian
						is_ai = no
						NOR = {
							#is_heir_of = scope:attacker
							is_close_family_of = scope:attacker
							is_allied_to = scope:attacker
						}
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_by_ward
						desc = msg_war_declared_by_ward_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#Close family your rival
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}				
					any_relation = {
						type = rival
						is_ai = no
						NOR = {
							#is_heir_of = scope:attacker
							is_close_family_of = scope:attacker
							is_allied_to = scope:attacker
							has_relation_nemesis = scope:attacker
						}
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_by_rival
						desc = msg_war_declared_by_rival_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#Close family your nemesis
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}				
					any_relation = {
						type = nemesis
						is_ai = no
						NOR = {
							#is_heir_of = scope:attacker
							is_close_family_of = scope:attacker
							is_allied_to = scope:attacker
						}
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_by_nemesis
						desc = msg_war_declared_by_nemesis_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#Close family your guardian #NEW
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}				
					any_relation = {
						type = ward
						is_ai = no
						NOR = {
							#is_heir_of = scope:attacker
							is_close_family_of = scope:attacker
							is_allied_to = scope:attacker
						}
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_by_guardian
						desc = msg_war_declared_by_guardian_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#Close family your mentor #NEW
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}				
					any_relation = {
						type = student
						is_ai = no
						NOR = {
							#is_heir_of = scope:attacker
							is_close_family_of = scope:attacker
							is_allied_to = scope:attacker
						}
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_by_mentor
						desc = msg_war_declared_by_mentor_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#Close family your student #NEW
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}				
					any_relation = {
						type = mentor
						is_ai = no
						NOR = {
							#is_heir_of = scope:attacker
							is_close_family_of = scope:attacker
							is_allied_to = scope:attacker
						}
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_by_student
						desc = msg_war_declared_by_student_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}			
			#Close family your Head of Faith
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}
					faith = {
						exists = faith.religious_head
						faith.religious_head = scope:attacker
					}
					any_player = {
						faith = scope:attacker.faith
						NOR = {
							is_close_family_of = scope:attacker
							is_allied_to = scope:attacker
						}
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_by_head_of_faith
						desc = msg_war_declared_by_head_of_faith_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}	
			#Extended Family  your cousin #NEW 
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					global_var:notify_of_war_family = 2
					any_extended_family_member = {
						is_ai = no
						is_cousin_of = scope:attacker
						NOR = {
							#is_heir_of = scope:attacker
							is_allied_to = scope:attacker
							has_relation_lover = scope:attacker
							has_relation_soulmate = scope:attacker
							has_relation_rival = scope:attacker
							has_relation_nemesis = scope:attacker
							has_relation_friend = scope:attacker
							has_relation_best_friend = scope:attacker
							has_relation_ward = scope:attacker
							has_relation_guardian = scope:attacker
							has_relation_student = scope:attacker
							has_relation_mentor = scope:attacker
						}
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_by_cousin
						desc = msg_war_declared_by_cousin_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#Extended Family  your uncle #NEW
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					global_var:notify_of_war_family = 2
					is_male = yes
					any_extended_family_member = {
						is_ai = no
						is_nibling_of = scope:attacker
						NOR = {
							#is_heir_of = scope:attacker
							is_allied_to = scope:attacker
							has_relation_lover = scope:attacker
							has_relation_soulmate = scope:attacker
							has_relation_rival = scope:attacker
							has_relation_nemesis = scope:attacker
							has_relation_friend = scope:attacker
							has_relation_best_friend = scope:attacker
							has_relation_ward = scope:attacker
							has_relation_guardian = scope:attacker
							has_relation_student = scope:attacker
							has_relation_mentor = scope:attacker
						}
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_by_uncle
						desc = msg_war_declared_by_uncle_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#Extended Family  your aunt #NEW
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					global_var:notify_of_war_family = 2
					is_female = yes
					any_extended_family_member = {
						is_ai = no
						is_nibling_of = scope:attacker
						NOR = {
							#is_heir_of = scope:attacker
							is_allied_to = scope:attacker
							has_relation_lover = scope:attacker
							has_relation_soulmate = scope:attacker
							has_relation_rival = scope:attacker
							has_relation_nemesis = scope:attacker
							has_relation_friend = scope:attacker
							has_relation_best_friend = scope:attacker
							has_relation_ward = scope:attacker
							has_relation_guardian = scope:attacker
							has_relation_student = scope:attacker
							has_relation_mentor = scope:attacker
						}
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_by_aunt
						desc = msg_war_declared_by_aunt_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#Your Nephew #NEW
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					global_var:notify_of_war_family = 2
					is_male = yes
					any_extended_family_member = {
						is_ai = no
						is_uncle_or_aunt_of = scope:attacker
						NOR = {
							#is_heir_of = scope:attacker
							is_allied_to = scope:attacker
							has_relation_lover = scope:attacker
							has_relation_soulmate = scope:attacker
							has_relation_rival = scope:attacker
							has_relation_nemesis = scope:attacker
							has_relation_friend = scope:attacker
							has_relation_best_friend = scope:attacker
							has_relation_ward = scope:attacker
							has_relation_guardian = scope:attacker
							has_relation_student = scope:attacker
							has_relation_mentor = scope:attacker
						}
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_by_nephew
						desc = msg_war_declared_by_nephew_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#Your Niece #NEW
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					global_var:notify_of_war_family = 2
					is_female = yes
					any_extended_family_member = {
						is_ai = no
						is_uncle_or_aunt_of = scope:attacker
						NOR = {
							#is_heir_of = scope:attacker
							is_allied_to = scope:attacker
							has_relation_lover = scope:attacker
							has_relation_soulmate = scope:attacker
							has_relation_rival = scope:attacker
							has_relation_nemesis = scope:attacker
							has_relation_friend = scope:attacker
							has_relation_best_friend = scope:attacker
							has_relation_ward = scope:attacker
							has_relation_guardian = scope:attacker
							has_relation_student = scope:attacker
							has_relation_mentor = scope:attacker
						}
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_by_niece
						desc = msg_war_declared_by_niece_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#Extended family catch-all not needed??
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					global_var:notify_of_war_family = 2
					any_extended_family_member = {
						is_ai = no
						NOR = {
							#is_heir_of = scope:attacker
							is_allied_to = scope:attacker
							is_nibling_of = scope:attacker
							is_uncle_or_aunt_of = scope:attacker
							is_cousin_of = scope:attacker
							has_relation_lover = scope:attacker
							has_relation_soulmate = scope:attacker
							has_relation_rival = scope:attacker
							has_relation_nemesis = scope:attacker
							has_relation_friend = scope:attacker
							has_relation_best_friend = scope:attacker
							has_relation_ward = scope:attacker
							has_relation_guardian = scope:attacker
							has_relation_student = scope:attacker
							has_relation_mentor = scope:attacker
						}
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_on_extended_family
						desc = msg_war_declared_on_extended_family_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#House member attacker #Tricky
			if = {
				limit = {
					exists = global_var:notify_of_war_dynasty
					OR = {
						global_var:notify_of_war_dynasty = 1
						global_var:notify_of_war_dynasty = 2
					}
					house = {
						any_house_member = {					
							is_ai = no
							NOT = {
								AND = {
									exists = global_var:notify_of_war_family
									OR = {
											global_var:notify_of_war_family = 1
											global_var:notify_of_war_family = 2
									}
									is_ai = no
									OR = {
										is_close_family_of = scope:attacker
										#is_heir_of = scope:attacker
										is_allied_to = scope:attacker
										has_relation_lover = scope:attacker
										has_relation_soulmate = scope:attacker
										has_relation_rival = scope:attacker
										has_relation_nemesis = scope:attacker
										has_relation_friend = scope:attacker
										has_relation_best_friend = scope:attacker
										has_relation_ward = scope:attacker
										has_relation_guardian = scope:attacker
										has_relation_student = scope:attacker
										has_relation_mentor = scope:attacker
									}
								}
							}	
							NOT = {
								AND = {
									exists = global_var:notify_of_war_family
									global_var:notify_of_war_family = 2
									is_ai = no
									is_extended_family_of = scope:attacker
								}
							}
						}					
					}
				}
				every_player = {
					limit = { is_ai = no }
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_by_house_member
						desc = msg_war_declared_by_house_member_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}		
			#Dynast Attacker #Tricky
			if = {
				limit = {
					exists = global_var:notify_of_war_dynasty
					OR = {
						global_var:notify_of_war_dynasty = 2
					}
					dynasty = {
						any_dynasty_member = {				
							is_ai = no
							NOT = { house = scope:attacker.house }
							NOT = {
								AND = {
									exists = global_var:notify_of_war_family
									OR = {
										global_var:notify_of_war_family = 1
										global_var:notify_of_war_family = 2
									}
									is_ai = no
									OR = {
										is_close_family_of = scope:attacker
										#is_heir_of = scope:attacker
										is_allied_to = scope:attacker
										has_relation_lover = scope:attacker
										has_relation_soulmate = scope:attacker
										has_relation_rival = scope:attacker
										has_relation_nemesis = scope:attacker
										has_relation_friend = scope:attacker
										has_relation_best_friend = scope:attacker
										has_relation_ward = scope:attacker
										has_relation_guardian = scope:attacker
										has_relation_student = scope:attacker
										has_relation_mentor = scope:attacker
									}
								}
							}
							NOT = {
								AND = {
									exists = global_var:notify_of_war_family
									global_var:notify_of_war_family = 2
									is_ai = no
									is_extended_family_of = scope:attacker
								}
							}
						}
					}					
				}
				every_player = {
					limit = { is_ai = no }
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_by_dynasty_member
						desc = msg_war_declared_by_dynasty_member_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#Vassal External Attacker (doesn't need defensive version?)
			if = {
				limit = {
					exists = global_var:notify_of_war_vassal_wars
					OR = {
						global_var:notify_of_war_vassal_wars = 1
						global_var:notify_of_war_vassal_wars = 2
					}
					any_liege_or_above = {
						is_ai = no
						NOT = { is_liege_or_above_of = scope:defender }
						NOT = { THIS = scope:defender }
						NOT = {
							AND = {
								exists = global_var:notify_of_war_family
								OR = {
									global_var:notify_of_war_family = 1
									global_var:notify_of_war_family = 2
								}
								is_ai = no
								OR = {
									is_close_family_of = scope:attacker
									#is_heir_of = scope:attacker
									is_allied_to = scope:attacker
									has_relation_lover = scope:attacker
									has_relation_soulmate = scope:attacker
									has_relation_rival = scope:attacker
									has_relation_nemesis = scope:attacker
									has_relation_friend = scope:attacker
									has_relation_best_friend = scope:attacker
									has_relation_ward = scope:attacker
									has_relation_guardian = scope:attacker
									has_relation_student = scope:attacker
									has_relation_mentor = scope:attacker
								}
							}
						}
						NOT = {
							AND = {
								exists = global_var:notify_of_war_family
								global_var:notify_of_war_family = 2
								is_ai = no
								is_extended_family_of = scope:attacker
							}
						}
						NOT = {
							AND = {
								exists = global_var:notify_of_war_dynasty
								OR = {
									global_var:notify_of_war_dynasty = 1
									global_var:notify_of_war_dynasty = 2			
								}
								is_ai = no
								house = scope:attacker.house
							}
						}
						NOT = {
							AND = {
								exists = global_var:notify_of_war_dynasty
								global_var:notify_of_war_dynasty = 2
								is_ai = no								
								dynasty = scope:attacker.dynasty
							}
						}
					}
				}			
				every_player = {
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_by_vassal_external
						desc = msg_war_declared_by_vassal_external_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#Vassal Internal Attacker (doesn't need defensive version)??
			if = {
				limit = {
					exists = global_var:notify_of_war_vassal_wars
					global_var:notify_of_war_vassal_wars = 2
					any_liege_or_above = {
						is_ai = no
						is_liege_or_above_of = scope:defender
						NOT = {
							AND = {
								exists = global_var:notify_of_war_family
								OR = {
									global_var:notify_of_war_family = 1
									global_var:notify_of_war_family = 2
								}
								is_ai = no
								OR = {
									is_close_family_of = scope:attacker
									#is_heir_of = scope:attacker
									is_allied_to = scope:attacker
									has_relation_lover = scope:attacker
									has_relation_soulmate = scope:attacker
									has_relation_rival = scope:attacker
									has_relation_nemesis = scope:attacker
									has_relation_friend = scope:attacker
									has_relation_best_friend = scope:attacker
									has_relation_ward = scope:attacker
									has_relation_guardian = scope:attacker
									has_relation_student = scope:attacker
									has_relation_mentor = scope:attacker
								}
							}
						}
						NOT = {
							AND = {
								exists = global_var:notify_of_war_family
								global_var:notify_of_war_family = 2
								is_ai = no
								is_extended_family_of = scope:attacker
							}
						}
						NOT = {
							AND = {
								exists = global_var:notify_of_war_dynasty
								OR = {
									global_var:notify_of_war_dynasty = 1
									global_var:notify_of_war_dynasty = 2			
								}
								is_ai = no
								house = scope:attacker.house
							}
						}
						NOT = {
							AND = {
								exists = global_var:notify_of_war_dynasty
								global_var:notify_of_war_dynasty = 2
								is_ai = no								
								dynasty = scope:attacker.dynasty
							}
						}
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_by_vassal_internal
						desc = msg_war_declared_by_vassal_internal_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#Neighbour declares war
			if = {
				limit = {
					exists = global_var:notify_of_neighbour_wars
					global_var:notify_of_neighbour_wars = 1
					is_independent_ruler = yes
					any_neighboring_top_liege_realm_owner = {
						is_ai = no
						NOT = {
							AND = {
								exists = global_var:notify_of_war_family
								OR = {
									global_var:notify_of_war_family = 1
									global_var:notify_of_war_family = 2
								}
								is_ai = no
								OR = {
									is_close_family_of = scope:attacker
									#is_heir_of = scope:attacker
									is_allied_to = scope:attacker
									has_relation_lover = scope:attacker
									has_relation_soulmate = scope:attacker
									has_relation_rival = scope:attacker
									has_relation_nemesis = scope:attacker
									has_relation_friend = scope:attacker
									has_relation_best_friend = scope:attacker
									has_relation_ward = scope:attacker
									has_relation_guardian = scope:attacker
									has_relation_student = scope:attacker
									has_relation_mentor = scope:attacker
								}
							}
						}
						NOT = {
							AND = {
								exists = global_var:notify_of_war_family
								global_var:notify_of_war_family = 2
								is_ai = no
								is_extended_family_of = scope:attacker
							}
						}
						NOT = {
							AND = {
								exists = global_var:notify_of_war_dynasty
								OR = {
									global_var:notify_of_war_dynasty = 1
									global_var:notify_of_war_dynasty = 2			
								}
								is_ai = no
								house = scope:attacker.house
							}
						}
						NOT = {
							AND = {
								exists = global_var:notify_of_war_dynasty
								global_var:notify_of_war_dynasty = 2
								is_ai = no								
								dynasty = scope:attacker.dynasty
							}
						}
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_by_neighbour
						desc = msg_war_declared_by_neighbour_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
		}
		#DEFENDER SWITCH
		scope:defender = {
			#bw_build_revolt_defenses_effect = yes #BARONSWARS For The Barons' Wars mod compatibility. Make sure War Alerts is lower in the Paradox Launcher mod list than The Barons' Wars.
			#Vanilla notification to vassals that liege has been attacked
			#if = {
			#	limit = {
			#		any_vassal_or_below = { is_ai = no }
			#	}
			#	every_vassal_or_below = {
			#		limit = { is_ai = no }
			#		send_interface_toast = {
			#			type = msg_war_declared_on_liege
			#			title = msg_war_declared_on_liege
			#			desc = msg_war_declared_on_liege_desc
			#			left_icon = scope:defender
			#			right_icon = scope:attacker
			#		}
			#	}
			#}
			#Peasant war notification to liege catch-all for non-specific vassals
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					any_liege_or_above = {
						is_ai = no
						NOR = {
							is_close_family_of = scope:defender
							#is_heir_of = scope:defender
							is_allied_to = scope:defender
							has_relation_lover = scope:defender
							has_relation_soulmate = scope:defender
							has_relation_rival = scope:defender
							has_relation_nemesis = scope:defender
							has_relation_friend = scope:defender
							has_relation_best_friend = scope:defender
							has_relation_ward = scope:defender
							has_relation_guardian = scope:defender
							has_relation_student = scope:defender
							has_relation_mentor = scope:defender
							house = scope:defender.house
							dynasty = scope:defender.dynasty
							faith = {
								exists = faith.religious_head
								faith.religious_head = scope:defender
							}
						}
					}
					scope:war = {
						OR ={
							using_cb = peasant_war
							using_cb = populist_war
						}
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_peasant_war_declared_on_vassal
						desc = msg_peasant_war_declared_on_vassal_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}	
			#Pinned Character defender
			if = {
				limit = {
					exists = global_var:notify_of_war_pinned				
					global_var:notify_of_war_pinned = 1			
					any_pinning_character = {
						is_ai = no
						NOT = {
							AND = {	
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1					
								is_ai = no
								is_liege_or_above_of = scope:defender
								scope:war = {
									OR ={
										using_cb = peasant_war
										using_cb = populist_war
									}
								}
							}
						}
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_neutral_message
						title = msg_war_declared_on_pinned
						desc = msg_war_declared_on_pinned_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family wife defender
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}
					is_female = yes
					any_spouse = {
						is_spouse_of = scope:defender
						is_ai = no
						is_male = yes
						NOT = { has_relation_soulmate = scope:defender }
						NOT = {
							AND = {	
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1					
								is_ai = no
								is_liege_or_above_of = scope:defender
								scope:war = {
									OR ={
										using_cb = peasant_war
										using_cb = populist_war
									}
								}
							}
						}
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_wife
						desc = msg_war_declared_on_wife_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family wife and soulmate defender
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}
					is_female = yes
					any_spouse = {
						is_spouse_of = scope:defender
						is_ai = no
						is_male = yes
						has_relation_soulmate = scope:defender
						NOT = {
							AND = {	
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1					
								is_ai = no
								is_liege_or_above_of = scope:defender
								scope:war = {
									OR ={
										using_cb = peasant_war
										using_cb = populist_war
									}
								}
							}
						}					
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_wife_soulmate
						desc = msg_war_declared_on_wife_soulmate_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family husband defender
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}
					is_male = yes
					any_spouse = { 
						is_spouse_of = scope:defender
						is_ai = no
						is_female = yes
						NOT = { has_relation_soulmate = scope:defender }
						NOT = {
							AND = {	
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1					
								is_ai = no
								is_liege_or_above_of = scope:defender
								scope:war = {
									OR ={
										using_cb = peasant_war
										using_cb = populist_war
									}
								}
							}
						}					
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_husband
						desc = msg_war_declared_on_husband_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family husband and soulmate defender
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}
					is_male = yes
					any_spouse = { 
						is_spouse_of = scope:defender
						is_ai = no
						is_female = yes
						has_relation_soulmate = scope:defender
						NOT = {
							AND = {	
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1					
								is_ai = no
								is_liege_or_above_of = scope:defender
								scope:war = {
									OR ={
										using_cb = peasant_war
										using_cb = populist_war
									}
								}
							}
						}					
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_husband_soulmate
						desc = msg_war_declared_on_husband_soulmate_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family concubine defender
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}
					any_consort = { 
						NOT = { is_spouse_of = scope:defender }
						is_ai = no
						NOT = { has_relation_soulmate = scope:defender }
						NOT = {
							AND = {	
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1					
								is_ai = no
								is_liege_or_above_of = scope:defender
								scope:war = {
									OR ={
										using_cb = peasant_war
										using_cb = populist_war
									}
								}
							}
						}					
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_concubine
						desc = msg_war_declared_on_concubine_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family concubine soulmate defender
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}
					any_consort = { 
						NOT = { is_spouse_of = scope:defender }
						is_ai = no
						has_relation_soulmate = scope:defender
						NOT = {
							AND = {	
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1					
								is_ai = no
								is_liege_or_above_of = scope:defender
								scope:war = {
									OR ={
										using_cb = peasant_war
										using_cb = populist_war
									}
								}
							}
						}
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_concubine_soulmate
						desc = msg_war_declared_on_concubine_soulmate_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family son defender
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}
					is_male = yes
					any_parent = {
						is_ai = no
						NOT = {
							AND = {	
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1					
								is_ai = no
								is_liege_or_above_of = scope:defender
								scope:war = {
									OR ={
										using_cb = peasant_war
										using_cb = populist_war
									}
								}
							}
						}
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_son
						desc = msg_war_declared_on_son_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}					
			#Close family daughter defender
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}
					is_female = yes
					any_parent = {
						is_ai = no
						NOT = {
							AND = {	
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1					
								is_ai = no
								is_liege_or_above_of = scope:defender
								scope:war = {
									OR ={
										using_cb = peasant_war
										using_cb = populist_war
									}
								}
							}
						}					
					}
				}
				every_player = {
					limit = { is_ai = no }
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_daughter
						desc = msg_war_declared_on_daughter_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family father defender
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}
					is_male = yes
					any_child = {
						is_ai = no
						NOT = {
							AND = {	
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1					
								is_ai = no
								is_liege_or_above_of = scope:defender
								scope:war = {
									OR ={
										using_cb = peasant_war
										using_cb = populist_war
									}
								}
							}
						}
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_father
						desc = msg_war_declared_on_father_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family mother defender
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}
					is_female = yes
					any_child = {
						is_ai = no
						NOT = {
							AND = {	
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1					
								is_ai = no
								is_liege_or_above_of = scope:defender
								scope:war = {
									OR ={
										using_cb = peasant_war
										using_cb = populist_war
									}
								}
							}
						}
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_mother
						desc = msg_war_declared_on_mother_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family brother defender
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}
					is_male = yes
					any_sibling = {
						is_ai = no
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_brother
						desc = msg_war_declared_on_brother_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family sister defender
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}
					is_female = yes
					any_sibling = {
						is_ai = no
						NOT = {
							AND = {	
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1					
								is_ai = no
								is_liege_or_above_of = scope:defender
								scope:war = {
									OR ={
										using_cb = peasant_war
										using_cb = populist_war
									}
								}
							}
						}					
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_sister
						desc = msg_war_declared_on_sister_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Grandson defender #NEW
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}
					is_male = yes
					any_close_family_member = {
						is_ai = no
						is_grandparent_of = scope:defender
						NOT = {
							AND = {	
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1					
								is_ai = no
								is_liege_or_above_of = scope:defender
								scope:war = {
									OR ={
										using_cb = peasant_war
										using_cb = populist_war
									}
								}
							}
						}
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_grandson
						desc = msg_war_declared_on_grandson_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Granddaughter defender #NEW
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}
					is_female = yes
					any_close_family_member = {
						is_ai = no
						is_grandparent_of = scope:defender
						NOT = {
							AND = {	
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1					
								is_ai = no
								is_liege_or_above_of = scope:defender
								scope:war = {
									OR ={
										using_cb = peasant_war
										using_cb = populist_war
									}
								}
							}
						}
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_granddaughter
						desc = msg_war_declared_on_granddaughter_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Grandfather defender #NEW
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}
					is_male = yes
					any_close_family_member = {
						is_ai = no
						is_grandchild_of = scope:defender
						NOT = {
							AND = {	
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1					
								is_ai = no
								is_liege_or_above_of = scope:defender
								scope:war = {
									OR ={
										using_cb = peasant_war
										using_cb = populist_war
									}
								}
							}
						}
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_grandfather
						desc = msg_war_declared_on_grandfather_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Grandmother defender #NEW
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
						NOT = {
							AND = {	
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1					
								is_ai = no
								is_liege_or_above_of = scope:defender
								scope:war = {
									OR ={
										using_cb = peasant_war
										using_cb = populist_war
									}
								}
							}
						}
					}
					is_female = yes
					any_close_family_member = {
						is_ai = no
						is_grandchild_of = scope:defender
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_grandmother
						desc = msg_war_declared_on_grandmother_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Other close family not needed??
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
						NOT = {
							AND = {	
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1					
								is_ai = no
								is_liege_or_above_of = scope:defender
								scope:war = {
									OR ={
										using_cb = peasant_war
										using_cb = populist_war
									}
								}
							}
						}
					}
					any_close_family_member = {
						is_ai = no
						NOT = { is_consort_of = scope:defender }
						NOT = { is_spouse_of = scope:defender }
						NOT = { is_sibling_of = scope:defender }
						NOT = { is_parent_of = scope:defender }
						NOT = { is_grandchild_of = scope:defender }
						NOT = { is_grandparent_of = scope:defender }
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_close_relative
						desc = msg_war_declared_on_close_relative_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Heir HASHEDOUT #TODO
#			if = {
#				limit = {
#					exists = global_var:notify_of_war_family
#					OR = {
#						global_var:notify_of_war_family = 1
#						global_var:notify_of_war_family = 2
#					}
#					is_player_heir_of = { #Doesn't work "simple assign" "not expecting bracket"
#						any_player = {
#							is_ai = no
#							#NOT = { is_close_family_of = scope:defender }
#							NOT = {
#								AND = {	
#									exists = global_var:notify_of_war_peasant
#									global_var:notify_of_war_peasant = 1					
#									is_ai = no
#									is_liege_or_above_of = scope:defender
#									scope:war = {
#										OR ={
#											using_cb = peasant_war
#											using_cb = populist_war
#										}
#									}
#								}
#							}
#						}
#					}
#				}
#				every_player = {
#					send_interface_message = {
#						desc = msg_war_declared_on_heir_message
#						left_icon = scope:defender
#						right_icon = scope:attacker
#					}
#				}
#			}
			#Close family your ally
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}
					any_ally = {
						is_ai = no
						NOT = {
							AND = {	
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1					
								is_ai = no
								is_liege_or_above_of = scope:defender
								scope:war = {
									OR ={
										using_cb = peasant_war
										using_cb = populist_war
									}
								}
							}
						}
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_ally
						desc = msg_war_declared_on_ally_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}		
			#Close family your lover
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}				
					any_relation = {
						type = lover
						is_ai = no
						NOR = {
							#is_heir_of = scope:defender
							is_close_family_of = scope:defender
							is_allied_to = scope:defender
						}
						NOT = {
							AND = {	
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1					
								is_ai = no
								is_liege_or_above_of = scope:defender
								scope:war = {
									OR ={
										using_cb = peasant_war
										using_cb = populist_war
									}
								}
							}
						}						
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_lover
						desc = msg_war_declared_on_lover_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family your soulmate
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}				
					any_relation = {
						type = soulmate
						is_ai = no
						NOR = {
							#is_heir_of = scope:defender
							is_close_family_of = scope:defender
							is_allied_to = scope:defender
						}
						NOT = {
							AND = {	
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1					
								is_ai = no
								is_liege_or_above_of = scope:defender
								scope:war = {
									OR ={
										using_cb = peasant_war
										using_cb = populist_war
									}
								}
							}
						}					
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_soulmate
						desc = msg_war_declared_on_soulmate_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family your friend
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}				
					any_relation = {
						type = friend
						is_ai = no
						NOR = {
							#is_heir_of = scope:defender
							is_close_family_of = scope:defender
							is_allied_to = scope:defender
							has_relation_best_friend = scope:defender
						}
						NOT = {
							AND = {	
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1					
								is_ai = no
								is_liege_or_above_of = scope:defender
								scope:war = {
									OR ={
										using_cb = peasant_war
										using_cb = populist_war
									}
								}
							}
						}						
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_friend
						desc = msg_war_declared_on_friend_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family your best friend
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}				
					any_relation = {
						type = best_friend
						is_ai = no
						NOR = {
							#is_heir_of = scope:defender
							is_close_family_of = scope:defender
							is_allied_to = scope:defender
						}
						NOT = {
							AND = {	
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1					
								is_ai = no
								is_liege_or_above_of = scope:defender
								scope:war = {
									OR ={
										using_cb = peasant_war
										using_cb = populist_war
									}
								}
							}
						}						
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_best_friend
						desc = msg_war_declared_on_best_friend_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family your ward #NOT RECIPRICOL
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}				
					any_relation = {
						type = guardian
						is_ai = no
						NOR = {
							#is_heir_of = scope:defender
							is_close_family_of = scope:defender
							is_allied_to = scope:defender
						}
						NOT = {
							AND = {	
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1					
								is_ai = no
								is_liege_or_above_of = scope:defender
								scope:war = {
									OR ={
										using_cb = peasant_war
										using_cb = populist_war
									}
								}
							}
						}						
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_ward
						desc = msg_war_declared_on_ward_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family your rival
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}				
					any_relation = {
						type = rival
						is_ai = no
						NOR = {
							#is_heir_of = scope:defender
							is_close_family_of = scope:defender
							is_allied_to = scope:defender
							has_relation_nemesis = scope:defender
						}
						NOT = {
							AND = {	
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1					
								is_ai = no
								is_liege_or_above_of = scope:defender
								scope:war = {
									OR ={
										using_cb = peasant_war
										using_cb = populist_war
									}
								}
							}
						}						
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_on_rival
						desc = msg_war_declared_on_rival_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family your nemesis
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}				
					any_relation = {
						type = nemesis
						is_ai = no
						NOR = {
							#is_heir_of = scope:defender
							is_close_family_of = scope:defender
							is_allied_to = scope:defender
						}
						NOT = {
							AND = {	
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1					
								is_ai = no
								is_liege_or_above_of = scope:defender
								scope:war = {
									OR ={
										using_cb = peasant_war
										using_cb = populist_war
									}
								}
							}
						}						
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_good_message
						title = msg_war_declared_on_nemesis
						desc = msg_war_declared_on_nemesis_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family your guardian #NEW
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}				
					any_relation = {
						type = ward
						is_ai = no
						NOR = {
							#is_heir_of = scope:defender
							is_close_family_of = scope:defender
							is_allied_to = scope:defender
						}
						NOT = {
							AND = {	
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1					
								is_ai = no
								is_liege_or_above_of = scope:defender
								scope:war = {
									OR ={
										using_cb = peasant_war
										using_cb = populist_war
									}
								}
							}
						}						
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_guardian
						desc = msg_war_declared_on_guardian_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family your mentor #NEW
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}				
					any_relation = {
						type = student
						is_ai = no
						NOR = {
							#is_heir_of = scope:defender
							is_close_family_of = scope:defender
							is_allied_to = scope:defender
						}
						NOT = {
							AND = {	
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1					
								is_ai = no
								is_liege_or_above_of = scope:defender
								scope:war = {
									OR ={
										using_cb = peasant_war
										using_cb = populist_war
									}
								}
							}
						}						
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_mentor
						desc = msg_war_declared_on_mentor_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family your student #NEW
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}				
					any_relation = {
						type = mentor
						is_ai = no
						NOR = {
							#is_heir_of = scope:defender
							is_close_family_of = scope:defender
							is_allied_to = scope:defender
						}
						NOT = {
							AND = {	
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1					
								is_ai = no
								is_liege_or_above_of = scope:defender
								scope:war = {
									OR ={
										using_cb = peasant_war
										using_cb = populist_war
									}
								}
							}
						}						
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_mentor
						desc = msg_war_declared_on_mentor_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}			
			#Close family your Head of Faith
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					OR = {
						global_var:notify_of_war_family = 1
						global_var:notify_of_war_family = 2
					}
					faith = {
						exists = faith.religious_head
						faith.religious_head = scope:defender
					}
					any_player = {
						faith = scope:defender.faith
						NOR = {
							is_close_family_of = scope:defender
							is_allied_to = scope:defender
						}
						NOT = {
							AND = {	
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1					
								is_ai = no
								is_liege_or_above_of = scope:defender
								scope:war = {
									OR ={
										using_cb = peasant_war
										using_cb = populist_war
									}
								}
							}
						}						
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_head_of_faith
						desc = msg_war_declared_on_head_of_faith_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#Extended Family  your cousin #NEW 
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					global_var:notify_of_war_family = 2
					any_extended_family_member = {
						is_ai = no
						is_cousin_of = scope:defender
						NOR = {
							#is_heir_of = scope:defender
							is_allied_to = scope:defender
							has_relation_lover = scope:defender
							has_relation_soulmate = scope:defender
							has_relation_rival = scope:defender
							has_relation_nemesis = scope:defender
							has_relation_friend = scope:defender
							has_relation_best_friend = scope:defender
							has_relation_ward = scope:defender
							has_relation_guardian = scope:defender
							has_relation_student = scope:defender
							has_relation_mentor = scope:defender
						}
						NOT = {
							AND = {	
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1					
								is_ai = no
								is_liege_or_above_of = scope:defender
								scope:war = {
									OR ={
										using_cb = peasant_war
										using_cb = populist_war
									}
								}
							}
						}						
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_cousin
						desc = msg_war_declared_on_cousin_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}			
			#Extended Family  your uncle #NEW
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					global_var:notify_of_war_family = 2
					is_male = yes
					any_extended_family_member = {
						is_ai = no
						is_nibling_of = scope:defender
						NOR = {
							#is_heir_of = scope:defender
							is_allied_to = scope:defender
							has_relation_lover = scope:defender
							has_relation_soulmate = scope:defender
							has_relation_rival = scope:defender
							has_relation_nemesis = scope:defender
							has_relation_friend = scope:defender
							has_relation_best_friend = scope:defender
							has_relation_ward = scope:defender
							has_relation_guardian = scope:defender
							has_relation_student = scope:defender
							has_relation_mentor = scope:defender
						}
						NOT = {
							AND = {	
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1					
								is_ai = no
								is_liege_or_above_of = scope:defender
								scope:war = {
									OR ={
										using_cb = peasant_war
										using_cb = populist_war
									}
								}
							}
						}						
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_uncle
						desc = msg_war_declared_on_uncle_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Extended Family  your aunt #NEW
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					global_var:notify_of_war_family = 2
					is_female = yes
					any_extended_family_member = {
						is_ai = no
						is_nibling_of = scope:defender
						NOR = {
							#is_heir_of = scope:defender
							is_allied_to = scope:defender
							has_relation_lover = scope:defender
							has_relation_soulmate = scope:defender
							has_relation_rival = scope:defender
							has_relation_nemesis = scope:defender
							has_relation_friend = scope:defender
							has_relation_best_friend = scope:defender
							has_relation_ward = scope:defender
							has_relation_guardian = scope:defender
							has_relation_student = scope:defender
							has_relation_mentor = scope:defender
						}
						NOT = {
							AND = {	
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1					
								is_ai = no
								is_liege_or_above_of = scope:defender
								scope:war = {
									OR ={
										using_cb = peasant_war
										using_cb = populist_war
									}
								}
							}
						}						
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_aunt
						desc = msg_war_declared_on_aunt_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Your Nephew #NEW
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					global_var:notify_of_war_family = 2
					is_male = yes
					any_extended_family_member = {
						is_ai = no
						is_uncle_or_aunt_of = scope:defender
						NOR = {
							#is_heir_of = scope:defender
							is_allied_to = scope:defender
							has_relation_lover = scope:defender
							has_relation_soulmate = scope:defender
							has_relation_rival = scope:defender
							has_relation_nemesis = scope:defender
							has_relation_friend = scope:defender
							has_relation_best_friend = scope:defender
							has_relation_ward = scope:defender
							has_relation_guardian = scope:defender
							has_relation_student = scope:defender
							has_relation_mentor = scope:defender
						}
						NOT = {
							AND = {	
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1					
								is_ai = no
								is_liege_or_above_of = scope:defender
								scope:war = {
									OR ={
										using_cb = peasant_war
										using_cb = populist_war
									}
								}
							}
						}						
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_nephew
						desc = msg_war_declared_on_nephew_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Your Niece #NEW
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					global_var:notify_of_war_family = 2
					is_female = yes
					any_extended_family_member = {
						is_ai = no
						is_uncle_or_aunt_of = scope:defender
						NOR = {
							#is_heir_of = scope:defender
							is_allied_to = scope:defender
							has_relation_lover = scope:defender
							has_relation_soulmate = scope:defender
							has_relation_rival = scope:defender
							has_relation_nemesis = scope:defender
							has_relation_friend = scope:defender
							has_relation_best_friend = scope:defender
							has_relation_ward = scope:defender
							has_relation_guardian = scope:defender
							has_relation_student = scope:defender
							has_relation_mentor = scope:defender
						}
						NOT = {
							AND = {	
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1					
								is_ai = no
								is_liege_or_above_of = scope:defender
								scope:war = {
									OR ={
										using_cb = peasant_war
										using_cb = populist_war
									}
								}
							}
						}						
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_niece
						desc = msg_war_declared_on_niece_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Extended family catch-all not needed??
			if = {
				limit = {
					exists = global_var:notify_of_war_family
					global_var:notify_of_war_family = 2
					any_extended_family_member = {
						is_ai = no
						NOR = {
							#is_heir_of = scope:defender
							is_allied_to = scope:defender
							is_nibling_of = scope:defender
							is_uncle_or_aunt_of = scope:defender
							is_cousin_of = scope:defender
							has_relation_lover = scope:defender
							has_relation_soulmate = scope:defender
							has_relation_rival = scope:defender
							has_relation_nemesis = scope:defender
							has_relation_friend = scope:defender
							has_relation_best_friend = scope:defender
							has_relation_ward = scope:defender
							has_relation_guardian = scope:defender
							has_relation_student = scope:defender
							has_relation_mentor = scope:defender
						}
						NOT = {
							AND = {	
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1					
								is_ai = no
								is_liege_or_above_of = scope:defender
								scope:war = {
									OR ={
										using_cb = peasant_war
										using_cb = populist_war
									}
								}
							}
						}						
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_extended_family
						desc = msg_war_declared_on_extended_family_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#House member defender #Tricky #SCOPED
			if = {
				limit = {
					exists = global_var:notify_of_war_dynasty
					OR = {
						global_var:notify_of_war_dynasty = 1
						global_var:notify_of_war_dynasty = 2
					}
					scope:defender.house = {
						any_house_member = {					
							is_ai = no
							NOT = {
								AND = {
									exists = global_var:notify_of_war_family
									OR = {
											global_var:notify_of_war_family = 1
											global_var:notify_of_war_family = 2
									}
									is_ai = no
									OR = {
										is_close_family_of = scope:defender
										#is_heir_of = scope:defender
										is_allied_to = scope:defender
										has_relation_lover = scope:defender
										has_relation_soulmate = scope:defender
										has_relation_rival = scope:defender
										has_relation_nemesis = scope:defender
										has_relation_friend = scope:defender
										has_relation_best_friend = scope:defender
										has_relation_ward = scope:defender
										has_relation_guardian = scope:defender
										has_relation_student = scope:defender
										has_relation_mentor = scope:defender
									}
								}
							}	
							NOT = {
								AND = {
									exists = global_var:notify_of_war_family
									global_var:notify_of_war_family = 2
									is_ai = no
									is_extended_family_of = scope:defender
								}
							}
							NOT = {
								AND = {	
									exists = global_var:notify_of_war_peasant
									global_var:notify_of_war_peasant = 1					
									is_ai = no
									is_liege_or_above_of = scope:defender
									scope:war = {
										OR ={
											using_cb = peasant_war
											using_cb = populist_war
										}
									}
								}
							}							
						}					
					}
				}
				every_player = {
					limit = { is_ai = no }
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_house_member
						desc = msg_war_declared_on_house_member_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}		
			#Dynast defender #Tricky
			if = {
				limit = {
					exists = global_var:notify_of_war_dynasty
					OR = {
						global_var:notify_of_war_dynasty = 2
					}
					scope:defender.dynasty = {
						any_dynasty_member = {				
							is_ai = no
							NOT = { house = scope:defender.house }
							NOT = {
								AND = {
									exists = global_var:notify_of_war_family
									OR = {
										global_var:notify_of_war_family = 1
										global_var:notify_of_war_family = 2
									}
									is_ai = no
									OR = {
										is_close_family_of = scope:defender
										#is_heir_of = scope:defender
										is_allied_to = scope:defender
										has_relation_lover = scope:defender
										has_relation_soulmate = scope:defender
										has_relation_rival = scope:defender
										has_relation_nemesis = scope:defender
										has_relation_friend = scope:defender
										has_relation_best_friend = scope:defender
										has_relation_ward = scope:defender
										has_relation_guardian = scope:defender
										has_relation_student = scope:defender
										has_relation_mentor = scope:defender
									}
								}
							}
							NOT = {
								AND = {
									exists = global_var:notify_of_war_family
									global_var:notify_of_war_family = 2
									is_ai = no
									is_extended_family_of = scope:defender
								}
							}
							NOT = {
								AND = {	
									exists = global_var:notify_of_war_peasant
									global_var:notify_of_war_peasant = 1					
									is_ai = no
									is_liege_or_above_of = scope:defender
									scope:war = {
										OR ={
											using_cb = peasant_war
											using_cb = populist_war
										}
									}
								}
							}							
						}
					}					
				}
				every_player = {
					limit = { is_ai = no }
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_dynasty_member
						desc = msg_war_declared_on_dynasty_member_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Vassal External defender (catchall defensive version) #SPECIAL New
			if = {
				limit = {
					exists = global_var:notify_of_war_vassal_wars
					OR = {
						global_var:notify_of_war_vassal_wars = 1
						global_var:notify_of_war_vassal_wars = 2
					}
					NOR = {
						scope:war = { using_cb = peasant_war }
						scope:war = { using_cb = populist_war }
					}
					any_liege_or_above = {
						is_ai = no
						NOT = { is_liege_or_above_of = scope:attacker }
						NOT = {
							AND = {
								exists = global_var:notify_of_war_family
								OR = {
									global_var:notify_of_war_family = 1
									global_var:notify_of_war_family = 2
								}
								is_ai = no
								OR = {
									is_close_family_of = scope:defender
									#is_heir_of = scope:defender
									is_allied_to = scope:defender
									has_relation_lover = scope:defender
									has_relation_soulmate = scope:defender
									has_relation_rival = scope:defender
									has_relation_nemesis = scope:defender
									has_relation_friend = scope:defender
									has_relation_best_friend = scope:defender
									has_relation_ward = scope:defender
									has_relation_guardian = scope:defender
									has_relation_student = scope:defender
									has_relation_mentor = scope:defender
								}
							}
						}
						NOT = {
							AND = {
								exists = global_var:notify_of_war_family
								global_var:notify_of_war_family = 2
								is_ai = no
								is_extended_family_of = scope:defender
							}
						}
						NOT = {
							AND = {
								exists = global_var:notify_of_war_dynasty
								OR = {
									global_var:notify_of_war_dynasty = 1
									global_var:notify_of_war_dynasty = 2			
								}
								is_ai = no
								house = scope:defender.house
							}
						}
						NOT = {
							AND = {
								exists = global_var:notify_of_war_dynasty
								global_var:notify_of_war_dynasty = 2
								is_ai = no								
								dynasty = scope:defender.dynasty
							}
						}
					}
				}			
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_vassal_external
						desc = msg_war_declared_on_vassal_external_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Vassal Internal defender (for civil wars if peasant war turned off)?? #SPECIAL #New
			if = {
				limit = {
					exists = global_var:notify_of_war_vassal_wars
					global_var:notify_of_war_vassal_wars = 2
					OR = {
						scope:war = { using_cb = peasant_war }
						scope:war = { using_cb = populist_war }
					}
					any_liege_or_above = {
						is_ai = no
						NOT = {
							AND = {
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1
								is_ai = no
							}
							AND = {
								exists = global_var:notify_of_war_family
								OR = {
									global_var:notify_of_war_family = 1
									global_var:notify_of_war_family = 2
								}
								is_ai = no
								OR = {
									is_close_family_of = scope:defender
									#is_heir_of = scope:defender
									is_allied_to = scope:defender
									has_relation_lover = scope:defender
									has_relation_soulmate = scope:defender
									has_relation_rival = scope:defender
									has_relation_nemesis = scope:defender
									has_relation_friend = scope:defender
									has_relation_best_friend = scope:defender
									has_relation_ward = scope:defender
									has_relation_guardian = scope:defender
									has_relation_student = scope:defender
									has_relation_mentor = scope:defender
								}
							}
						}
						NOT = {
							AND = {
								exists = global_var:notify_of_war_family
								global_var:notify_of_war_family = 2
								is_ai = no
								is_extended_family_of = scope:defender
							}
						}
						NOT = {
							AND = {
								exists = global_var:notify_of_war_dynasty
								OR = {
									global_var:notify_of_war_dynasty = 1
									global_var:notify_of_war_dynasty = 2			
								}
								is_ai = no
								house = scope:defender.house
							}
						}
						NOT = {
							AND = {
								exists = global_var:notify_of_war_dynasty
								global_var:notify_of_war_dynasty = 2
								is_ai = no								
								dynasty = scope:defender.dynasty
							}
						}
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_vassal_internal
						desc = msg_war_declared_on_vassal_internal_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Neighbour declares war
			if = {
				limit = {
					exists = global_var:notify_of_neighbour_wars
					global_var:notify_of_neighbour_wars = 1
					is_independent_ruler = yes
					any_neighboring_top_liege_realm_owner = {
						is_ai = no
						NOT = {
							AND = {
								exists = global_var:notify_of_war_family
								OR = {
									global_var:notify_of_war_family = 1
									global_var:notify_of_war_family = 2
								}
								is_ai = no
								OR = {
									is_close_family_of = scope:defender
									#is_heir_of = scope:defender
									is_allied_to = scope:defender
									has_relation_lover = scope:defender
									has_relation_soulmate = scope:defender
									has_relation_rival = scope:defender
									has_relation_nemesis = scope:defender
									has_relation_friend = scope:defender
									has_relation_best_friend = scope:defender
									has_relation_ward = scope:defender
									has_relation_guardian = scope:defender
									has_relation_student = scope:defender
									has_relation_mentor = scope:defender
								}
							}
						}
						NOT = {
							AND = {
								exists = global_var:notify_of_war_family
								global_var:notify_of_war_family = 2
								is_ai = no
								is_extended_family_of = scope:defender
							}
						}
						NOT = {
							AND = {
								exists = global_var:notify_of_war_dynasty
								OR = {
									global_var:notify_of_war_dynasty = 1
									global_var:notify_of_war_dynasty = 2			
								}
								is_ai = no
								house = scope:defender.house
							}
						}
						NOT = {
							AND = {
								exists = global_var:notify_of_war_dynasty
								global_var:notify_of_war_dynasty = 2
								is_ai = no								
								dynasty = scope:defender.dynasty
							}
						}
						NOT = {
							AND = {	
								exists = global_var:notify_of_war_peasant
								global_var:notify_of_war_peasant = 1					
								is_ai = no
								is_liege_or_above_of = scope:defender
								scope:war = {
									OR ={
										using_cb = peasant_war
										using_cb = populist_war
									}
								}
							}
						}						
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_war_declared_on_neighbour
						desc = msg_war_declared_on_neighbour_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#PEASANT WAR DEFENDERS
			#Pinned Defender
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}
					any_pinning_character = {
						is_ai = no
						is_liege_or_above_of = scope:defender				
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_neutral_message
						title = msg_war_declared_on_pinned
						desc = msg_war_declared_on_pinned_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family wife defender
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}
					is_female = yes
					any_spouse = {
						is_spouse_of = scope:defender
						is_ai = no
						is_male = yes
						NOT = { has_relation_soulmate = scope:defender }
						is_liege_or_above_of = scope:defender
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_peasant_war_declared_on_wife
						desc = msg_peasant_war_declared_on_wife_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family wife and soulmate defender
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}
					is_female = yes
					any_spouse = {
						is_spouse_of = scope:defender
						is_ai = no
						is_male = yes
						has_relation_soulmate = scope:defender
						is_liege_or_above_of = scope:defender
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_peasant_war_declared_on_wife_soulmate
						desc = msg_peasant_war_declared_on_wife_soulmate_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family husband defender
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}
					is_male = yes
					any_spouse = { 
						is_spouse_of = scope:defender
						is_ai = no
						is_female = yes
						NOT = { has_relation_soulmate = scope:defender }
						is_liege_or_above_of = scope:defender
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_peasant_war_declared_on_husband
						desc = msg_peasant_war_declared_on_husband_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family husband and soulmate defender #UPTO
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}
					is_male = yes
					any_spouse = { 
						is_spouse_of = scope:defender
						is_ai = no
						is_female = yes
						has_relation_soulmate = scope:defender
						is_liege_or_above_of = scope:defender
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_peasant_war_declared_on_husband_soulmate
						desc = msg_peasant_war_declared_on_husband_soulmate_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family concubine defender
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}
					any_consort = { 
						NOT = { is_spouse_of = scope:defender }
						is_ai = no
						NOT = { has_relation_soulmate = scope:defender }
						is_liege_or_above_of = scope:defender
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_peasant_war_declared_on_concubine
						desc = msg_peasant_war_declared_on_concubine_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family concubine soulmate defender
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}
					any_consort = { 
						NOT = { is_spouse_of = scope:defender }
						is_ai = no
						has_relation_soulmate = scope:defender
						is_liege_or_above_of = scope:defender
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_peasant_war_declared_on_concubine_soulmate
						desc = msg_peasant_war_declared_on_concubine_soulmate_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family son defender
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}
					is_male = yes
					any_parent = {
						is_ai = no
						is_liege_or_above_of = scope:defender
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_peasant_war_declared_on_son
						desc = msg_peasant_war_declared_on_son_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}					
			#Close family daughter defender
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}
					is_female = yes
					any_parent = {
						is_ai = no
						is_liege_or_above_of = scope:defender
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_peasant_war_declared_on_daughter
						desc = msg_peasant_war_declared_on_daughter_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family father defender
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}
					is_male = yes
					any_child = {
						is_ai = no
						is_liege_or_above_of = scope:defender
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_peasant_war_declared_on_father
						desc = msg_peasant_war_declared_on_father_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family mother defender
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}
					is_female = yes
					any_child = {
						is_ai = no
						is_liege_or_above_of = scope:defender
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_peasant_war_declared_on_mother
						desc = msg_peasant_war_declared_on_mother_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family brother defender
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}
					is_male = yes
					any_sibling = {
						is_ai = no
						is_liege_or_above_of = scope:defender
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_peasant_war_declared_on_brother
						desc = msg_peasant_war_declared_on_brother_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family sister defender
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}
					is_female = yes
					any_sibling = {
						is_ai = no
						is_liege_or_above_of = scope:defender
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_peasant_war_declared_on_sister
						desc = msg_peasant_war_declared_on_sister_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Grandson defender #NEW
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}
					is_male = yes
					any_close_family_member = {
						is_ai = no
						is_grandparent_of = scope:defender
						is_liege_or_above_of = scope:defender
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_peasant_war_declared_on_grandson
						desc = msg_peasant_war_declared_on_grandson_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Granddaughter defender #NEW
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}
					is_female = yes
					any_close_family_member = {
						is_ai = no
						is_grandparent_of = scope:defender
						is_liege_or_above_of = scope:defender
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_peasant_war_declared_on_granddaughter
						desc = msg_peasant_war_declared_on_granddaughter_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Grandfather defender #NEW
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}
					is_male = yes
					any_close_family_member = {
						is_ai = no
						is_grandchild_of = scope:defender
						is_liege_or_above_of = scope:defender
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_peasant_war_declared_on_grandfather
						desc = msg_peasant_war_declared_on_grandfather_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Grandmother defender #NEW
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}
					is_female = yes
					any_close_family_member = {
						is_ai = no
						is_grandchild_of = scope:defender
						is_liege_or_above_of = scope:defender
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_peasant_war_declared_on_grandmother
						desc = msg_peasant_war_declared_on_grandmother_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Other close family not needed??
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}
					any_close_family_member = {
						is_ai = no
						NOT = { is_consort_of = scope:defender }
						NOT = { is_spouse_of = scope:defender }
						NOT = { is_sibling_of = scope:defender }
						NOT = { is_parent_of = scope:defender }
						NOT = { is_grandchild_of = scope:defender }
						NOT = { is_grandparent_of = scope:defender }
						is_liege_or_above_of = scope:defender
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_peasant_war_declared_on_close_relative
						desc = msg_peasant_war_declared_on_close_relative_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Heir HASHEDOUT #TODO
#			if = {
#				limit = {
#					exists = global_var:notify_of_war_peasant
#					global_var:notify_of_war_peasant = 1					
#					scope:war = {
#						OR ={
#						using_cb = peasant_war
#						using_cb = populist_war
#						}
#					}
#					is_player_heir_of = { #Doesn't work "simple assign" "not expecting bracket"
#						any_player = {
#							is_ai = no
#							#NOT = { is_close_family_of = scope:defender }
#							is_liege_or_above_of = scope:defender
#						}
#					}
#				}
#				every_player = {
#					send_interface_message = {
#						type = notify_war_neutral_message
#						title = msg_peasant_war_declared_on_heir
#						desc = msg_peasant_war_declared_on_heir_message
#						right_icon = scope:attacker
#					}
#				}
#			}
			#Close family your ally
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}
					any_ally = {
						is_ai = no
						is_liege_or_above_of = scope:defender	
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_peasant_war_declared_on_ally
						desc = msg_peasant_war_declared_on_ally_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}		
			#Close family your lover
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}			
					any_relation = {
						type = lover
						is_ai = no
						NOR = {
							#is_heir_of = scope:defender
							is_close_family_of = scope:defender
							is_allied_to = scope:defender
						}
						is_liege_or_above_of = scope:defender
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_peasant_war_declared_on_lover
						desc = msg_peasant_war_declared_on_lover_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family your soulmate
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}				
					any_relation = {
						type = soulmate
						is_ai = no
						NOR = {
							#is_heir_of = scope:defender
							is_close_family_of = scope:defender
							is_allied_to = scope:defender
						}
						is_liege_or_above_of = scope:defender
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_peasant_war_declared_on_soulmate
						desc = msg_peasant_war_declared_on_soulmate_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family your friend
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}				
					any_relation = {
						type = friend
						is_ai = no
						NOR = {
							#is_heir_of = scope:defender
							is_close_family_of = scope:defender
							is_allied_to = scope:defender
							has_relation_best_friend = scope:defender
						}
						is_liege_or_above_of = scope:defender
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_peasant_war_declared_on_friend
						desc = msg_peasant_war_declared_on_friend_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family your best friend
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}				
					any_relation = {
						type = best_friend
						is_ai = no
						NOR = {
							#is_heir_of = scope:defender
							is_close_family_of = scope:defender
							is_allied_to = scope:defender
						}
						is_liege_or_above_of = scope:defender
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_peasant_war_declared_on_best_friend
						desc = msg_peasant_war_declared_on_best_friend_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family your ward #NOT RECIPRICOL
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}				
					any_relation = {
						type = guardian
						is_ai = no
						NOR = {
							#is_heir_of = scope:defender
							is_close_family_of = scope:defender
							is_allied_to = scope:defender
						}
						is_liege_or_above_of = scope:defender
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_peasant_war_declared_on_ward
						desc = msg_peasant_war_declared_on_ward_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family your rival
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}				
					any_relation = {
						type = rival
						is_ai = no
						NOR = {
							#is_heir_of = scope:defender
							is_close_family_of = scope:defender
							is_allied_to = scope:defender
							has_relation_nemesis = scope:defender
						}
						is_liege_or_above_of = scope:defender
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_good_message
						title = msg_peasant_war_declared_on_rival
						desc = msg_peasant_war_declared_on_rival_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family your nemesis
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}			
					any_relation = {
						type = nemesis
						is_ai = no
						NOR = {
							#is_heir_of = scope:defender
							is_close_family_of = scope:defender
							is_allied_to = scope:defender
						}
						is_liege_or_above_of = scope:defender
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_good_message
						title = msg_peasant_war_declared_on_nemesis
						desc = msg_peasant_war_declared_on_nemesis_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family your guardian #NEW
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}			
					any_relation = {
						type = ward
						is_ai = no
						NOR = {
							#is_heir_of = scope:defender
							is_close_family_of = scope:defender
							is_allied_to = scope:defender
						}
						is_liege_or_above_of = scope:defender
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_peasant_war_declared_on_guardian
						desc = msg_peasant_war_declared_on_guardian_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family your mentor #NEW
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}			
					any_relation = {
						type = student
						is_ai = no
						NOR = {
							#is_heir_of = scope:defender
							is_close_family_of = scope:defender
							is_allied_to = scope:defender
						}
						is_liege_or_above_of = scope:defender
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_peasant_war_declared_on_mentor
						desc = msg_peasant_war_declared_on_mentor_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Close family your student #NEW
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}			
					any_relation = {
						type = mentor
						is_ai = no
						NOR = {
							#is_heir_of = scope:defender
							is_close_family_of = scope:defender
							is_allied_to = scope:defender
						}
						is_liege_or_above_of = scope:defender
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_peasant_war_declared_on_mentor
						desc = msg_peasant_war_declared_on_mentor_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}			
			#Close family your Head of Faith
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}
					faith = {
						exists = faith.religious_head
						faith.religious_head = scope:defender
					}
					any_player = {
						faith = scope:defender.faith
						NOR = {
							is_close_family_of = scope:defender
							is_allied_to = scope:defender
						}
						is_liege_or_above_of = scope:defender
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_peasant_war_declared_on_head_of_faith
						desc = msg_peasant_war_declared_on_head_of_faith_message
						left_icon = scope:attacker
						right_icon = scope:defender
					}
				}
			}
			#Extended Family  your cousin #NEW 
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}
					any_extended_family_member = {
						is_ai = no
						is_cousin_of = scope:defender
						NOR = {
							#is_heir_of = scope:defender
							is_allied_to = scope:defender
							has_relation_lover = scope:defender
							has_relation_soulmate = scope:defender
							has_relation_rival = scope:defender
							has_relation_nemesis = scope:defender
							has_relation_friend = scope:defender
							has_relation_best_friend = scope:defender
							has_relation_ward = scope:defender
							has_relation_guardian = scope:defender
							has_relation_student = scope:defender
							has_relation_mentor = scope:defender
						}
						is_liege_or_above_of = scope:defender
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_peasant_war_declared_on_cousin
						desc = msg_peasant_war_declared_on_cousin_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}			
			#Extended Family  your uncle #NEW
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}
					is_male = yes
					any_extended_family_member = {
						is_ai = no
						is_nibling_of = scope:defender
						NOR = {
							#is_heir_of = scope:defender
							is_allied_to = scope:defender
							has_relation_lover = scope:defender
							has_relation_soulmate = scope:defender
							has_relation_rival = scope:defender
							has_relation_nemesis = scope:defender
							has_relation_friend = scope:defender
							has_relation_best_friend = scope:defender
							has_relation_ward = scope:defender
							has_relation_guardian = scope:defender
							has_relation_student = scope:defender
							has_relation_mentor = scope:defender
						}
						is_liege_or_above_of = scope:defender
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_peasant_war_declared_on_uncle
						desc = msg_peasant_war_declared_on_uncle_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Extended Family  your aunt #NEW
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}
					is_female = yes
					any_extended_family_member = {
						is_ai = no
						is_nibling_of = scope:defender
						NOR = {
							#is_heir_of = scope:defender
							is_allied_to = scope:defender
							has_relation_lover = scope:defender
							has_relation_soulmate = scope:defender
							has_relation_rival = scope:defender
							has_relation_nemesis = scope:defender
							has_relation_friend = scope:defender
							has_relation_best_friend = scope:defender
							has_relation_ward = scope:defender
							has_relation_guardian = scope:defender
							has_relation_student = scope:defender
							has_relation_mentor = scope:defender
						}
						is_liege_or_above_of = scope:defender
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_peasant_war_declared_on_aunt
						desc = msg_peasant_war_declared_on_aunt_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Your Nephew #NEW
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}
					is_male = yes
					any_extended_family_member = {
						is_ai = no
						is_uncle_or_aunt_of = scope:defender
						NOR = {
							#is_heir_of = scope:defender
							is_allied_to = scope:defender
							has_relation_lover = scope:defender
							has_relation_soulmate = scope:defender
							has_relation_rival = scope:defender
							has_relation_nemesis = scope:defender
							has_relation_friend = scope:defender
							has_relation_best_friend = scope:defender
							has_relation_ward = scope:defender
							has_relation_guardian = scope:defender
							has_relation_student = scope:defender
							has_relation_mentor = scope:defender
						}
						is_liege_or_above_of = scope:defender
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_peasant_war_declared_on_nephew
						desc = msg_peasant_war_declared_on_nephew_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Your Niece #NEW
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}
					is_female = yes
					any_extended_family_member = {
						is_ai = no
						is_uncle_or_aunt_of = scope:defender
						NOR = {
							#is_heir_of = scope:defender
							is_allied_to = scope:defender
							has_relation_lover = scope:defender
							has_relation_soulmate = scope:defender
							has_relation_rival = scope:defender
							has_relation_nemesis = scope:defender
							has_relation_friend = scope:defender
							has_relation_best_friend = scope:defender
							has_relation_ward = scope:defender
							has_relation_guardian = scope:defender
							has_relation_student = scope:defender
							has_relation_mentor = scope:defender
						}
						is_liege_or_above_of = scope:defender
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_peasant_war_declared_on_niece
						desc = msg_peasant_war_declared_on_niece_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#Extended family catch-all not needed??
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}
					any_extended_family_member = {
						is_ai = no
						NOR = {
							#is_heir_of = scope:defender
							is_allied_to = scope:defender
							is_nibling_of = scope:defender
							is_uncle_or_aunt_of = scope:defender
							is_cousin_of = scope:defender
							has_relation_lover = scope:defender
							has_relation_soulmate = scope:defender
							has_relation_rival = scope:defender
							has_relation_nemesis = scope:defender
							has_relation_friend = scope:defender
							has_relation_best_friend = scope:defender
							has_relation_ward = scope:defender
							has_relation_guardian = scope:defender
							has_relation_student = scope:defender
							has_relation_mentor = scope:defender
						}
						is_liege_or_above_of = scope:defender
					}
				}
				every_player = {
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_peasant_war_declared_on_extended_family
						desc = msg_peasant_war_declared_on_extended_family_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}
			#House member defender #Tricky
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}
					scope:defender.house = {
						any_house_member = {					
							is_ai = no
							is_liege_or_above_of = scope:defender
							NOT = {
								AND = {
									exists = global_var:notify_of_war_family
									OR = {
											global_var:notify_of_war_family = 1
											global_var:notify_of_war_family = 2
									}
									is_ai = no
									OR = {
										is_close_family_of = scope:defender
										#is_heir_of = scope:defender
										is_allied_to = scope:defender
										has_relation_lover = scope:defender
										has_relation_soulmate = scope:defender
										has_relation_rival = scope:defender
										has_relation_nemesis = scope:defender
										has_relation_friend = scope:defender
										has_relation_best_friend = scope:defender
										has_relation_ward = scope:defender
										has_relation_guardian = scope:defender
										has_relation_student = scope:defender
										has_relation_mentor = scope:defender
									}
								}
							}	
							NOT = {
								AND = {
									exists = global_var:notify_of_war_family
									global_var:notify_of_war_family = 2
									is_ai = no
									is_extended_family_of = scope:defender
								}
							}
						}					
					}
				}
				every_player = {
					limit = { is_ai = no }
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_peasant_war_declared_on_house_member
						desc = msg_peasant_war_declared_on_house_member_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}		
			#Dynast defender #Tricky
			if = {
				limit = {
					exists = global_var:notify_of_war_peasant
					global_var:notify_of_war_peasant = 1					
					scope:war = {
						OR ={
						using_cb = peasant_war
						using_cb = populist_war
						}
					}
					scope:defender.dynasty = {
						any_dynasty_member = {				
							is_ai = no
							is_liege_or_above_of = scope:defender
							NOT = { house = scope:defender.house }
							NOT = {
								AND = {
									exists = global_var:notify_of_war_family
									OR = {
										global_var:notify_of_war_family = 1
										global_var:notify_of_war_family = 2
									}
									is_ai = no
									OR = {
										is_close_family_of = scope:defender
										#is_heir_of = scope:defender
										is_allied_to = scope:defender
										has_relation_lover = scope:defender
										has_relation_soulmate = scope:defender
										has_relation_rival = scope:defender
										has_relation_nemesis = scope:defender
										has_relation_friend = scope:defender
										has_relation_best_friend = scope:defender
										has_relation_ward = scope:defender
										has_relation_guardian = scope:defender
										has_relation_student = scope:defender
										has_relation_mentor = scope:defender
									}
								}
							}
							NOT = {
								AND = {
									exists = global_var:notify_of_war_family
									global_var:notify_of_war_family = 2
									is_ai = no
									is_extended_family_of = scope:defender
								}
							}
						}
					}					
				}
				every_player = {
					limit = { is_ai = no }
					send_interface_message = {
						type = notify_war_bad_message
						title = msg_peasant_war_declared_on_dynasty_member
						desc = msg_peasant_war_declared_on_dynasty_member_message
						left_icon = scope:defender
						right_icon = scope:attacker
					}
				}
			}	
		}
	}
}