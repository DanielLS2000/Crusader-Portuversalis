on_death = { #copy all chat messages to the heir and remember what private chats they were in, were they muted, did they mute anyone
	on_actions = {
		on_death_chat
	}
}

on_death_chat = {

	trigger = {
		is_ai = no
	}

	effect = {
		every_in_list = { # copy private messages
			variable = private_chat

			root.player_heir = {
				add_to_variable_list = {
					name = private_chat
					target = prev
				}
			}
		}

		player_heir = { # add yourself to your private chat members
			add_to_variable_list = {
				name = private_chat_members
				target = this
			}
		}

		every_player = { # create the list of chat rooms
			limit = {
				NOT = {
					this = root
				}
			}

			remove_list_variable = {
				name = players
				target = root
			}

			remove_list_variable = {
				name = players_right
				target = root
			}

			root.player_heir = {
				add_to_variable_list = {
					name = players
					target = prev
				}
			}
		}

		root.player_heir = { # add yourself to the list, to see your private room
			add_to_variable_list = {
				name = players
				target = this
			}
		}

		every_player = { # create the list of players on the right
			limit = {
				NOT = {
					this = root
				}
			}
			root.player_heir = {
				add_to_variable_list = {
					name = players_right
					target = prev
				}
			}
		}

		every_player = { # re-add the player to private rooms
			limit = {
				NOT = {
					this = root
				}
				is_target_in_variable_list = { # was player in a private room?
					name = private_chat_members
					target = root
				}
			}
			add_to_variable_list = { # add their heir to the room
				name = private_chat_members
				target = root.player_heir
			}
			remove_list_variable = { # remove the old player
				name = private_chat_members
				target = root
			}
		}

		every_player = { # re-add others to your private room
			limit = {
				NOT = {
					this = root
				}
				root = {
					is_target_in_variable_list = {
						name = private_chat_members
						target = prev
					}
				}
			}
			root.player_heir = {
				add_to_variable_list = {
					name = private_chat_members
					target = prev
				}
			}
		}

		if = { # copy any muted players
			limit = {
				has_variable_list = muted
			}
			every_in_list = {
				variable = muted
				root.player_heir = {
					add_to_variable_list = {
						name = muted
						target = prev
					}
				}
			}
		}

		every_player = { # was the player muted by anyone?
			limit = {
				is_target_in_variable_list = {
					name = muted
					target = root
				}
			}
			add_to_variable_list = {
				name = muted
				target = root.player_heir
			}
		}
	}
}
