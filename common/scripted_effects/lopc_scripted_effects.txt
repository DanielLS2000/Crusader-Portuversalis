lopc_leave_court_scripted_effect = {
	hidden_effect = {
		scope:courtier_x_liege = {
			remove_courtier_or_guest = root
		}
		remove_variable = lopc_court_performance
		remove_character_modifier = lopc_court_performance_modifier_0
		remove_character_modifier = lopc_court_performance_modifier_1
		remove_character_modifier = lopc_court_performance_modifier_2
		remove_character_modifier = lopc_court_performance_modifier_3
		remove_character_modifier = lopc_court_performance_modifier_4
		remove_character_modifier = lopc_courtier_0
		remove_character_modifier = lopc_courtier_1
		remove_character_modifier = lopc_courtier_2
		remove_character_modifier = lopc_courtier_3
		remove_character_modifier = lopc_courtier_4
		remove_character_modifier = lopc_moving_up
		remove_character_modifier = lopc_absent_courtier
		remove_character_modifier = lopc_adventurer
		remove_character_modifier = lopc_holy_order
		remove_character_modifier = lopc_merc
		remove_relation_lopc_employer = scope:courtier_x_liege
	}
}
lopc_get_independence = {
	create_title_and_vassal_change = {
		type = conquest
		save_scope_as = change
	}
	
	becomes_independent = { change = scope:change }
	resolve_title_and_vassal_change = scope:change
}
lopc_refresh_business = {
	if = {
		limit = { has_character_flag = flag:lopc_owns_business }
		if = {
			limit = { has_character_modifier = lopc_business_inn_mixed }
			hidden_effect = { 
				remove_character_modifier = lopc_business_inn_mixed
				add_character_modifier = lopc_business_inn_mixed
			}
		}
		else_if = {
			limit = { has_character_modifier = lopc_business_shop_mixed }
			hidden_effect = { 
				remove_character_modifier = lopc_business_shop_mixed
				add_character_modifier = lopc_business_shop_mixed
			}
		}
		else_if = {
			limit = { has_character_modifier = lopc_business_farm_mixed }
			hidden_effect = { 
				remove_character_modifier = lopc_business_farm_mixed
				add_character_modifier = lopc_business_farm_mixed
			}
		}
		else_if = {
			limit = { has_character_modifier = lopc_business_shipping_mixed }
			hidden_effect = { 
				remove_character_modifier = lopc_business_shipping_mixed
				add_character_modifier = lopc_business_shipping_mixed
			}
		}
		else_if = {
			limit = { has_character_modifier = lopc_business_trading_post_mixed }
			hidden_effect = { 
				remove_character_modifier = lopc_business_trading_post_mixed
				add_character_modifier = lopc_business_trading_post_mixed
			}
		}
	}
}
lopc_generic_service_scheme_prep_effect = {
	save_scope_as = scheme
	save_scope_value_as = {
		name = follow_up_event                  
		value = event_id:lopc_scheme_event.0001
	}
	if = {
		limit = {
			NOT = { exists = scope:suppress_next_event }
		}
		scheme_owner = { trigger_event = scheme_critical_moments.0002 }
	}
}

lopc_alms_service_scheme_prep_effect = {
	save_scope_as = scheme
	save_scope_value_as = {
		name = follow_up_event                  
		value = event_id:lopc_scheme_event.0011
	}
	if = {
		limit = {
			NOT = { exists = scope:suppress_next_event }
		}
		scheme_owner = { trigger_event = scheme_critical_moments.0002 }
	}
}

lopc_bodyguard_service_scheme_prep_effect = {
	save_scope_as = scheme
	save_scope_value_as = {
		name = follow_up_event                  
		value = event_id:lopc_scheme_event.0021
	}
	if = {
		limit = {
			NOT = { exists = scope:suppress_next_event }
		}
		scheme_owner = { trigger_event = scheme_critical_moments.0002 }
	}
}

lopc_champion_service_scheme_prep_effect = {
	save_scope_as = scheme
	save_scope_value_as = {
		name = follow_up_event                  
		value = event_id:lopc_scheme_event.0031
	}
	if = {
		limit = {
			NOT = { exists = scope:suppress_next_event }
		}
		scheme_owner = { trigger_event = scheme_critical_moments.0002 }
	}
}

lopc_clerical_service_scheme_prep_effect = {
	save_scope_as = scheme
	save_scope_value_as = {
		name = follow_up_event                  
		value = event_id:lopc_scheme_event.0041
	}
	if = {
		limit = {
			NOT = { exists = scope:suppress_next_event }
		}
		scheme_owner = { trigger_event = scheme_critical_moments.0002 }
	}
}

lopc_develop_service_scheme_prep_effect = {
	save_scope_as = scheme
	save_scope_value_as = {
		name = follow_up_event                  
		value = event_id:lopc_scheme_event.0051
	}
	if = {
		limit = {
			NOT = { exists = scope:suppress_next_event }
		}
		scheme_owner = { trigger_event = scheme_critical_moments.0002 }
	}
}

lopc_event_service_scheme_prep_effect = {
	save_scope_as = scheme
	save_scope_value_as = {
		name = follow_up_event                  
		value = event_id:lopc_scheme_event.0061
	}
	if = {
		limit = {
			NOT = { exists = scope:suppress_next_event }
		}
		scheme_owner = { trigger_event = scheme_critical_moments.0002 }
	}
}

lopc_minority_service_scheme_prep_effect = {
	save_scope_as = scheme
	save_scope_value_as = {
		name = follow_up_event                  
		value = event_id:lopc_scheme_event.0071
	}
	if = {
		limit = {
			NOT = { exists = scope:suppress_next_event }
		}
		scheme_owner = { trigger_event = scheme_critical_moments.0002 }
	}
}

lopc_physician_service_scheme_prep_effect = {
	save_scope_as = scheme
	save_scope_value_as = {
		name = follow_up_event                  
		value = event_id:lopc_scheme_event.0081
	}
	if = {
		limit = {
			NOT = { exists = scope:suppress_next_event }
		}
		scheme_owner = { trigger_event = scheme_critical_moments.0002 }
	}
}

lopc_republican_service_scheme_prep_effect = {
	save_scope_as = scheme
	save_scope_value_as = {
		name = follow_up_event                  
		value = event_id:lopc_scheme_event.0091
	}
	if = {
		limit = {
			NOT = { exists = scope:suppress_next_event }
		}
		scheme_owner = { trigger_event = scheme_critical_moments.0002 }
	}
}

lopc_strategic_service_scheme_prep_effect = {
	save_scope_as = scheme
	save_scope_value_as = {
		name = follow_up_event                  
		value = event_id:lopc_scheme_event.0101
	}
	if = {
		limit = {
			NOT = { exists = scope:suppress_next_event }
		}
		scheme_owner = { trigger_event = scheme_critical_moments.0002 }
	}
}

lopc_chronicler_service_scheme_prep_effect = {
	save_scope_as = scheme
	save_scope_value_as = {
		name = follow_up_event                  
		value = event_id:lopc_scheme_event.0111
	}
	if = {
		limit = {
			NOT = { exists = scope:suppress_next_event }
		}
		scheme_owner = { trigger_event = scheme_critical_moments.0002 }
	}
}
lopc_failed_service_scheme_effect = {
	$TARGET$ = { save_scope_as = target }
	scope:target = {
		add_opinion = {
			target = root 
			opinion = -10
			modifier = annoyed_opinion
		}
	}
	stress_impact = {
		base = minor_stress_impact_gain
		ambitious = miniscule_stress_impact_gain
		loyal = miniscule_stress_impact_gain
		arrogant = miniscule_stress_impact_gain
		diligent = miniscule_stress_impact_gain
	}
}
lopc_successful_service_scheme_effect = {
	$TARGET$ = { save_scope_as = target }
	scope:target = {
		add_opinion = {
			target = root 
			opinion = 5
			modifier = helpful_opinion
		}
	}
	change_lopc_performance = { amount = 5 }
	lopc_add_tiered_gold = {
		VALUE = 15
	}
}

lopc_add_tiered_gold = {
	add_gold = {
		value = $VALUE$
		if = {
			limit = {
				root = { has_character_modifier = lopc_courtier_1 }
			}
			multiply = 2
		}
		else_if = {
			limit = {
				root = { has_character_modifier = lopc_courtier_2 }
			}
			multiply = 3
		}
		else_if = {
			limit = {
				root = { has_character_modifier = lopc_courtier_3 }
			}
			multiply = 4
		}
		else_if = {
			limit = {
				root = { has_character_modifier = lopc_courtier_4 }
			}
			multiply = 5
		}
	}
}
lopc_add_war_modifier = {
	random_list = {
		10 = { add_character_modifier = { modifier = lopc_sound_military_advice_01 years = 1 } }
		10 = { add_character_modifier = { modifier = lopc_sound_military_advice_02 years = 1 } }
		10 = { add_character_modifier = { modifier = lopc_sound_military_advice_03 years = 1 } }
		10 = { add_character_modifier = { modifier = lopc_sound_military_advice_04 years = 1 } }
		10 = { add_character_modifier = { modifier = lopc_sound_military_advice_05 years = 1 } }
		10 = { add_character_modifier = { modifier = lopc_sound_military_advice_06 years = 1 } }
	}
}

lopc_great_treatment_effect = {
	if = {
		limit = { has_treatable_disease_trigger = yes }
		add_character_modifier = {
			modifier = safe_disease_treatment_success_high_modifier  
			years = 2
		}
	}
	else = {
		add_character_modifier = {
			modifier = safe_wound_treatment_success_high_modifier   
			years = 2
		}
	}
}
lopc_good_treatment_effect = {
	if = {
		limit = { has_treatable_disease_trigger = yes }
		add_character_modifier = {
			modifier = safe_disease_treatment_success_low_modifier  
			years = 2
		}
	}
	else = {
		add_character_modifier = {
			modifier = safe_wound_treatment_success_low_modifier   
			years = 2
		}
	}
}
lopc_bad_treatment_effect = {
	if = {
		limit = { has_treatable_disease_trigger = yes }
		add_character_modifier = {
			modifier = safe_disease_treatment_failure_modifier  
			years = 2
		}
	}
	else = {
		add_character_modifier = {
			modifier = safe_wound_treatment_failure_modifier   
			years = 2
		}
	}
}
lopc_awful_treatment_effect = {
	if = {
		limit = { has_treatable_disease_trigger = yes }
		add_character_modifier = {
			modifier = risky_disease_treatment_failure_modifier  
			years = 2
		}
	}
	else = {
		add_character_modifier = {
			modifier = risky_wound_treatment_failure_modifier   
			years = 2
		}
	}
}
# Expected scope is a lopc_courtier player
change_lopc_performance = {
	# Parameters:
	#  - amount: any positive or negative integer

	# Modify performance score
	change_variable = {
		name = lopc_court_performance
		add = $amount$
	}
	clamp_variable = {
		name = lopc_court_performance
		min = 1
		max = 100
	}

	# Notify player
	send_interface_message = {
		type = msg_chancellor_task_good
		title = lopc_performance_change_notification
			
		desc = {
			desc = lopc_performance_change_notification_desc
			first_valid = {
				triggered_desc = {
					trigger = {
						$amount$ >= 0
					}
					desc = { 
						desc = lopc_performance_change_notification_desc_positive_1
						first_valid = {
							triggered_desc = {
								trigger = { $amount$ = 1 }
								desc = lopc_performance_change_notification_desc_pos1
							}
							triggered_desc = {
								trigger = { $amount$ = 2 }
								desc = lopc_performance_change_notification_desc_pos2
							}
							triggered_desc = {
								trigger = { $amount$ = 3 }
								desc = lopc_performance_change_notification_desc_pos3
							}
							triggered_desc = {
								trigger = { $amount$ = 4 }
								desc = lopc_performance_change_notification_desc_pos4
							}
							triggered_desc = {
								trigger = { $amount$ = 5 }
								desc = lopc_performance_change_notification_desc_pos5
							}
							triggered_desc = {
								trigger = { $amount$ = 10 }
								desc = lopc_performance_change_notification_desc_pos10
							}
							triggered_desc = {
								trigger = { $amount$ = 24 }
								desc = lopc_performance_change_notification_desc_pos24
							}
							triggered_desc = {
								trigger = { $amount$ = 49 }
								desc = lopc_performance_change_notification_desc_pos49
							}
						}
						desc = lopc_performance_change_notification_desc_positive_2
					}
				}
				desc = { 
					desc = lopc_performance_change_notification_desc_negative_1
					first_valid = {
						triggered_desc = {
							trigger = { $amount$ = -1 }
							desc = lopc_performance_change_notification_desc_pos1
						}
						triggered_desc = {
							trigger = { $amount$ = -2 }
							desc = lopc_performance_change_notification_desc_pos2
						}
						triggered_desc = {
							trigger = { $amount$ = -3 }
							desc = lopc_performance_change_notification_desc_pos3
						}
						triggered_desc = {
							trigger = { $amount$ = -4 }
							desc = lopc_performance_change_notification_desc_pos4
						}
						triggered_desc = {
							trigger = { $amount$ = -5 }
							desc = lopc_performance_change_notification_desc_pos5
						}
						triggered_desc = {
							trigger = { $amount$ = -10 }
							desc = lopc_performance_change_notification_desc_pos10
						}
						triggered_desc = {
							trigger = { $amount$ = -24 }
							desc = lopc_performance_change_notification_desc_pos24
						}
						triggered_desc = {
							trigger = { $amount$ = -49 }
							desc = lopc_performance_change_notification_desc_pos49
						}
					}
					desc = lopc_performance_change_notification_desc_negative_2
				}
			}
		}
	}

	# Apply performance tier modifier
	hidden_effect = {
		remove_character_modifier = lopc_court_performance_modifier_0
		remove_character_modifier = lopc_court_performance_modifier_1
		remove_character_modifier = lopc_court_performance_modifier_2
		remove_character_modifier = lopc_court_performance_modifier_3
		remove_character_modifier = lopc_court_performance_modifier_4

		if = {
			limit = { var:lopc_court_performance = 100 }
			add_character_modifier = lopc_court_performance_modifier_4
		}
		else_if = {
			limit = { var:lopc_court_performance >= 75 }
			add_character_modifier = lopc_court_performance_modifier_3
		}
		else_if = {
			limit = { var:lopc_court_performance >= 50 }
			add_character_modifier = lopc_court_performance_modifier_2
		}
		else_if = {
			limit = { var:lopc_court_performance >= 25 }
			add_character_modifier = lopc_court_performance_modifier_1
		}
		else = {
			add_character_modifier = lopc_court_performance_modifier_0
		}
	}
}

lopc_request_court_position_cost = {
	if = {
		limit = { has_any_court_position = yes }
		custom_label = {
			text = lopc_promotion_cost_loc_02_desc
			add_prestige = -200
		}
	}
	else = {
		custom_label = {
			text = lopc_promotion_cost_loc_01_desc
			add_prestige = -100
		}
	}
}
