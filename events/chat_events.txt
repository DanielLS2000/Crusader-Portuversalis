namespace = chat

chat.1 = {
	type = character_event
	window = chat_event

	title = "NEW"
	desc = "NEW"
	# theme = ""

	immediate = {
		save_scope_as = sender
		set_variable = writing_message
		create_character = {
			age = 0
			name = "​"
			dynasty = none
			gender_female_chance = 50
			# location = root.capital_province
			employer = root
			faith = root.faith
			culture = root.culture
			save_scope_as = message
		}
		scope:message = {
			death = {
				death_reason = death_vanished
			}
			# add_to_global_variable_list = {
			# 	name = global_chat_messages
			# 	target = this
			# }
		}
	}

	widgets = {
		widget = {
			gui = "enter_chat_message"
			container = "chat_message_container"
			controller = name_character
			setup_scope = { scope:message = { save_scope_as = name_character_target } }
		}
	}

	option = {
		name = "send_option"
		# every_player = {
		# 	limit = {
		# 		NOT = {
		# 			is_target_in_variable_list = {
		# 				name = muted
		# 				target = root
		# 			}
		# 		}
		# 	}
		# 	add_to_variable_list = {
		# 		name = chat
		# 		target = scope:message
		# 	}
		# 	if = {
		# 		limit = {
		# 			has_variable_list = selected_chat
		# 		}
		# 		set_variable = unread
		# 	}
		# }
		add_to_global_variable_list = {
			name = chat
			target = scope:message
		}

		remove_variable = writing_message
	}

	option = {
		name = "CANCEL"
		remove_variable = writing_message
	}
}


chat.2 = { # private message
	type = character_event
	window = chat_event

	title = "NEW"
	desc = "NEW"
	# theme = silent


	immediate = {
		set_variable = writing_message
		create_character = {
			age = 0
			name = "​"
			dynasty = none
			employer = root
			gender_female_chance = 50
			# location = root.capital_province
			faith = root.faith
			culture = root.culture
			save_scope_as = message
		}
		scope:message = {
			death = {
				death_reason = death_vanished
			}
		}
	}

	widgets = {
		widget = {
			gui = "enter_chat_message"
			container = "chat_message_container"
			controller = name_character
			setup_scope = { scope:message = { save_scope_as = name_character_target } }
		}
	}

	option = {
		name = "send_option"
		scope:host = {
			add_to_variable_list = { #TODO this was sendind an error after death. I now remove the old character on death, hopefully it solves it?
				name = private_chat ###
				target = scope:message
			}
		}
		every_in_list = {
			variable = private_chat_members
			limit = {
				NOT = {
					is_target_in_variable_list = {
						name = selected_chat
						target = scope:host
					}
				}
			}
			add_to_variable_list = {
				name = unread_private
				target = scope:host
			}
		}
		remove_variable = writing_message
	}

	option = {
		name = "CANCEL"
		remove_variable = writing_message
	}
}

chat.3 = { #edit message
	type = character_event
	window = chat_event

	title = "NEW"
	desc = "NEW"
	# theme = silent


	widgets = {
		widget = {
			gui = "enter_chat_message"
			container = "chat_message_container"
			controller = name_character
			setup_scope = { scope:message = { save_scope_as = name_character_target } }
		}
	}
	option = {
		name = "confirm"
	}

	option = {
		name = "CLOSE_LABEL"
	}
}

chat.4 = { #edit your name
	type = character_event
	window = chat_event

	title = "NEW"
	desc = "NEW"
	# theme = silent


	widgets = {
		widget = {
			gui = "enter_chat_message"
			container = "chat_message_container"
			controller = name_character
			setup_scope = { scope:actor = { save_scope_as = name_character_target } }
		}
	}

	option = {
		name = "CLOSE_LABEL"
	}
}
